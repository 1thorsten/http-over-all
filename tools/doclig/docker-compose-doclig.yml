services:
  build-with-tools:
    image: 1thorsten/http-over-all:doclig
    build:
      context: ../..
      dockerfile: tools/doclig/Dockerfile

  hoa-doclig:
    container_name: hoa-doclig
    image: 1thorsten/http-over-all:doclig
    restart: unless-stopped
    
    labels:
      # value (false,all,admin)
      - docon.v1={"console":"all","control":"all","show":"http-over-all"}
    env_file:
      - ../../example-doclig.env
    ports:
      # http/1.1
      - "8338:80"
      #- "7227:3000"
      # http/2 ssl
      #- "4334:443"
    cap_add:
      # necessary for SSH and SMB
      - SYS_ADMIN
      # necessary for SMB
      - DAC_READ_SEARCH
    devices:
      - "/dev/fuse:/dev/fuse"
    #depends_on:
      #restheart:
      #  condition: service_started
      #rqlite:
      #  condition: service_healthy
    volumes:
      - /sys/fs/cgroup:/sys/fs/cgroup:rw
      - /var/run/docker.sock:/var/run/docker.sock:ro
      #- docker-data:/remote/docker
      - git-repos:/remote/git
      - local-data:/local-data
      - nginx-cache:/nginx-cache

  mariadb:
    image: mariadb:latest
    container_name: mariadb-server
    restart: unless-stopped
    environment:
      # Root Passwort setzen
      MYSQL_ROOT_PASSWORD: uluroot

      # Separaten Benutzer erstellen
      MYSQL_DATABASE: http-over-all
      MYSQL_USER: http-over-all
      MYSQL_PASSWORD: pass-http-over-all
    ports:
      - "3306:3306"
    #volumes:
      # Persistente Daten in separatem Volume
      # - mariadb_data:/var/lib/mysql
      # Optionale Konfigurationsdatei (falls ben√∂tigt)
      # - ./mariadb.cnf:/etc/mysql/mariadb.conf.d/50-server.cnf

volumes:
  #docker-data:
  git-repos:
  local-data:
  nginx-cache:
#  mariadb_data:

